<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Flaschenpost DEV</title>
  <style>

  </style>
</head>
<body>


<!-- LEISTE -->
<div id="leiste"></div>



    <!-- Modal -->
<div id="modal" class="modal" style="font-family: pixel;">
  <div class="modal-content" id="modal-content">
   <!-- <button class="close-btn" id="closeModal">&times;</button> -->
    
    
    
    <div id="links">
        <!--FLASCHEN BILD-->
        <img id="flaschenBild" src="" alt="Flaschenbild" />
        
    </div>
    

    <div id="rechts">
      <div id="flascheName" style="font-size: 40pt; display: inline-block;"></div>
      <div id="modalAbsender" style="font-size: 40pt; display: inline-block;"></div>
      <div id="modalZeit"></div>
      <div style="display: inline-block;">Flaschenpost-ID: </div>
      <div id="modalIdFlaschen" style="display: inline-block;"></div>
      <div id="scrollContent">
        <div id="msgBox">
          <div id="modalText" style="padding: 0px; font-size: 30pt;"></div>
        </div>
        <div id="respDiv">
          <div id="resp-Wrapper" class="resp-Wrapper">
            <textarea type="text" id="respInput" placeholder="Auf diese Flasche antworten" rows="1"></textarea>
            <button class="respBtn" id="respBtn">
              <img src="http://localhost:3000/absenden.png" alt="Icon" style="height: 40px; vertical-align: middle;" />
            </button>
          </div>
          <div id="antwortenScroll">
            <div id="respAbs"></div>
            <div id="respBox"></div>
            <br/>
          </div>
        </div>
    </div>


      </div>
   
    
  </div>
</div>

<!-- Hintergrund -->
<div id="hintergrund">
  <!--<video autoplay muted loop playsinline class="bg" id="bg">
  <source src="http://localhost:3000/flaschen/wasser.mp4" type="video/mp4" />-->
  <img src="http://localhost:3000/flaschen/wasser.gif" class="bg" id="bg" style="width: 100vw; height: 50vh;">
  
</video>
<div id="land">
  <img src="http://localhost:3000/flaschen/land.png">
</div>




</div>
<!-- Nachrichten reihen -->

<div id="flaschenContainer">
  <div id="row1" class="message-row1"></div> <!-- < 1 Tag -->
  <div id="row2" class="message-row2"></div> <!-- 1–2 Tage -->
  <div id="row3" class="message-row3"></div> <!-- 2–3 Tage -->
</div>
  <!-- user input -->
</div>


<div id="neueNachricht" class="modal">
  
    

    
      <div id="neueNachricht-modal-content" style="background-color: rgba(255,255,255,0.5); color: black; font-family: pixel;">
        <!-- Textareas -->
        <div id="neuLinks">
          <img src="http://localhost:3000/flaschen/anim/1.gif" id="flaschePreview"/>
        </div>

        <div id="neuRechts">
          <textarea id="nameInput" placeholder="Dein Name" rows="1" cols="40" style="resize: none;"></textarea><br />
          <textarea id="msgInput" placeholder="Deine Nachricht" rows="5" style="resize: none;"></textarea><br />

          <!-- Flaschentyp auswählen -->
          <label for="type"></label>
            <div class="flaschen-auswahl">
              <label>
                <input type="radio" name="type" value="fl1" checked>
                <img src="http://localhost:3000/flaschen/anim/1.gif" alt="Glas1" />
              </label>
              <label>
                <input type="radio" name="type" value="fl2">
                <img src="http://localhost:3000/flaschen/anim/2.gif" alt="Glas2" />
              </label>
              <label>
                <input type="radio" name="type" value="fl3">
                <img src="http://localhost:3000/flaschen/anim/3.gif" alt="Glas3" />
              </label>
              <label>
                <input type="radio" name="type" value="fl4">
                <img src="http://localhost:3000/flaschen/anim/4.gif" alt="Plastik1" />
              </label>
              <label>
                <input type="radio" name="type" value="fl5">
                <img src="http://localhost:3000/flaschen/anim/5.gif" alt="Plastik2" />
              </label>
              <label>
                <input type="radio" name="type" value="fl6">
                <img src="http://localhost:3000/flaschen/anim/6.gif" alt="Plastik3" />
              </label>
            </div>


            <style>
              .flaschen-auswahl {
              display: flex;
              gap: 10px;
              flex-wrap: wrap; /* optional für kleine Bildschirme */
              justify-content: space-evenly;
              margin-top: 2vh;
            }

            .flaschen-auswahl label {
              cursor: pointer;
              display: flex;
              flex-direction: column;
              align-items: center;
            }

            .flaschen-auswahl input[type="radio"] {
              display: none;
            }

            .flaschen-auswahl img {
              width: 60px; /* beliebige Größe */
              height: auto;
              opacity: 0.5;
              transition: opacity 0.2s ease;
              border: 3px solid transparent;
              border-radius: 0px;
            }

            .flaschen-auswahl input[type="radio"]:checked + img {
              opacity: 1;
              border-color: #000; /* oder eine andere Farbe zur Hervorhebung */
            }
            </style>


          <br />
          <!-- Farbe auswählen -->
          <label for="color"></label>
            <div class="farben-auswahl">
              <label>
                <input type="radio" name="color" value="cl0" checked>
                <span class="color-circle" style="background-color: rgb(255,255,255);"></span>
              </label>
              <label>
                <input type="radio" name="color" value="cl1">
                <span class="color-circle" style="background-color: rgb(40,40,40);"></span>
              </label>
              <label>
                <input type="radio" name="color" value="cl2">
                <span class="color-circle" style="background-color: rgb(220,50,50);"></span>
              </label>
              <label>
                <input type="radio" name="color" value="cl3">
                <span class="color-circle" style="background-color: rgb(55,180,220);"></span>
              </label>
              <label>
                <input type="radio" name="color" value="cl4">
                <span class="color-circle" style="background-color: rgb(56,220,90);"></span>
              </label>
              <label>
                <input type="radio" name="color" value="cl5">
                <span class="color-circle" style="background-color: rgb(212,55,220);"></span>
              </label>
              <label>
                <input type="radio" name="color" value="cl6">
                <span class="color-circle" style="background-color: rgb(220,180,50);"></span>
              </label>
            </div>
            <style>
              .farben-auswahl {
              display: flex;
              gap: 10px;
              margin-top: 0vh;
              margin-bottom: 2vh;
              flex-wrap: wrap;
              justify-content: space-evenly;
            }

            .farben-auswahl label {
              cursor: pointer;
            }

            .farben-auswahl input[type="radio"] {
              display: none;
            }

            .color-circle {
              width: 30px;
              height: 30px;
              border-radius: 0%;
              display: inline-block;
              border: 8px solid transparent;
              /*transition: border 0.2s ease;*/
              border: 3px solid black;
            }

            .farben-auswahl input[type="radio"]:checked + .color-circle {
              border: 8px solid #000; /* oder weiß, je nach Hintergrund */
              width: 20px;
              height: 20px;
              box-shadow: 0 0 4px rgba(0, 0, 0, 0.4);
            }
            </style>
        
          <button id="sendBtn">Nachricht senden</button>
      </div>
    </div>
</div>

<button id="neu">Neue Nachricht</button>


<div id="archivModal" class="archivModal" style="font-family: pixel;">
  <div class="modal-content-archiv">
    
    <div id="archivGrid"></div>
  </div>
</div>

<button id="archivOpen" class="archivOpen"> </button>
<div id="schiff">
  <img src="http://localhost:3000/schiff.gif">
</div>


<div id="himmel"></div>





<script>
    const messagesDiv = document.getElementById("messages");
    const modal = document.getElementById("modal");
    const modalText = document.getElementById("modalText");
    const msgBox = document.getElementById("msgBox");
    const modalAbsender = document.getElementById("modalAbsender");
    const modalZeit = document.getElementById("modalZeit");
    const modalFlasche = document.getElementById("flascheName");
    const modalID = document.getElementById("modalIdFlaschen");
    const closeModalBtn = document.getElementById("closeModal");
    const neueNachricht = document.getElementById("neueNachricht");
    const openNeu = document.getElementById("neu");
    const respBtn = document.getElementById("respBtn");
    const modalContent = document.getElementById("modal-content")
    const schiff = document.querySelector("#schiff img");

    const newMsg = document.getElementById("msgInput");
    const colorRadio = document.getElementById("color");


window.addEventListener("click", (event) => {
  if (event.target === modal) {
    modal.style.display = "none";
  }
  if (event.target === neueNachricht) {
    neueNachricht.style.display = "none";
  }
  const archivModal = document.getElementById("archivModal");
  if (event.target === archivModal) {
    archivModal.style.display = "none";
  }
});
    


const respInput = document.getElementById("respInput");

respInput.addEventListener("input", () => {
  respInput.style.height = "auto"; // Höhe zurücksetzen
  respInput.style.height = respInput.scrollHeight + "px"; // Höhe anpassen
});



function loadMessages() {


  fetch("http://localhost:3000/api/messages")
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        // Reihen leeren
        document.getElementById("row1").innerHTML = ""; // < 24h
        document.getElementById("row2").innerHTML = ""; // 24–48h
        document.getElementById("row3").innerHTML = ""; // 48–72h

        const now = new Date();

        const typeToAnim = {
          fl1: {
            stark: "http://localhost:3000/flaschen/anim/1w3p.gif",
            mittel: "http://localhost:3000/flaschen/anim/1w2p.gif",
            normal: "http://localhost:3000/flaschen/anim/1w.gif"     
              },
          fl2: {
            stark: "http://localhost:3000/flaschen/anim/2w3p.gif",
            mittel: "http://localhost:3000/flaschen/anim/2w2p.gif",
            normal: "http://localhost:3000/flaschen/anim/2w.gif"     
              },
          fl3: {
            stark: "http://localhost:3000/flaschen/anim/3w3p.gif",
            mittel: "http://localhost:3000/flaschen/anim/3w2p.gif",
            normal: "http://localhost:3000/flaschen/anim/3w.gif"     
              },
          fl4: {
            stark: "http://localhost:3000/flaschen/anim/4w3p.gif",
            mittel: "http://localhost:3000/flaschen/anim/4w2p.gif",
            normal: "http://localhost:3000/flaschen/anim/4w.gif"     
              },
          fl5: {
            stark: "http://localhost:3000/flaschen/anim/5w3p.gif",
            mittel: "http://localhost:3000/flaschen/anim/5w2p.gif",
            normal: "http://localhost:3000/flaschen/anim/5w.gif"     
              },
          fl6: {
            stark: "http://localhost:3000/flaschen/anim/6w3p.gif",
            mittel: "http://localhost:3000/flaschen/anim/6w2p.gif",
            normal: "http://localhost:3000/flaschen/anim/6w.gif"     
              },
        };

        const typeToImage = {
          fl1: "http://localhost:3000/flaschen/anim/1.gif",
          fl2: "http://localhost:3000/flaschen/anim/2.gif",
          fl3: "http://localhost:3000/flaschen/anim/3.gif",
          fl4: "http://localhost:3000/flaschen/anim/4.gif",
          fl5: "http://localhost:3000/flaschen/anim/5.gif",
          fl6: "http://localhost:3000/flaschen/anim/6.gif",
        };

          const typeToName = {
          fl1: "Mehrwegglasflasche",
          fl2: "Mehrwegglasflasche",
          fl3: "Einwegglasflasche",
          fl4: "Einwegpfandflasche",
          fl5: "Einwegpfandflasche",
          fl6: "Einwegpfandflasche",
        };

        const msgCol = {
          cl0: "rgb(255,255,255,0.5)",
          cl1: "rgb(40,40,40,0.5)",       // schwarz
          cl2: "rgb(220,50,50,0.5)",      // rot
          cl3: "rgb(55,180,220,0.5)",     // blau
          cl4: "rgb(56,220,90,0.5)",      // grün
          cl5: "rgb(212,55,220,0.5)",     // lila
          cl6: "rgb(220,180,50,0.5)",     // gelb
        };

        const txtCol = {
          cl0: "rgb(0,0,0)",
          cl1: "rgb(255,255,255)",    // schwarz
          cl2: "rgb(255,255,255)",    // rot
          cl3: "rgb(0,0,0)",          // blau
          cl4: "rgb(0,0,0)",          // grün
          cl5: "rgb(255,255,255)",    // lila
          cl6: "rgb(0,0,0)",          // gelb
        };

        

        data.messages.forEach(msg => {
          const time = new Date(msg.time);
          const hoursAgo = (now - time) / (1000 * 60 * 60);

          let pixelLevel = "normal";
          if (hoursAgo <= 24) {
            pixelLevel = "normal";
          } else if (hoursAgo <= 48) {
            pixelLevel = "mittel";
          } else if (hoursAgo <= 72) {
            pixelLevel = "stark";
          }

          const img = document.createElement("img");
          img.className = "msg-image";
          img.src = typeToAnim[msg.type]?.[pixelLevel] || "";
          img.alt = `${msg.name} (${time.toLocaleString()})`;
          img.title = `${msg.name} (${time.toLocaleString()})`;
          img.style.cursor = "pointer";

          img.addEventListener("click", () => {
            modalText.textContent = msg.msg;
            modalFlasche.textContent = typeToName[msg.type];
            modalAbsender.textContent = "von " + msg.name;
            //modalAbsender.innerHTML = 'von <strong>' + msg.name + '</strong>';

            const formattedTime = new Date(msg.time).toLocaleString("de-DE", {
              year: "numeric",
              month: "2-digit",
              day: "2-digit",
              hour: "2-digit",
              minute: "2-digit"
            });

            modalZeit.textContent = formattedTime;
            modalID.textContent = msg.idFlaschen;
            modal.style.display = "flex";
            modalContent.style.backgroundColor = msgCol[msg.color] || "#fff";
            modalContent.style.color = txtCol[msg.color];
            msgBox.style.color = txtCol[msg.color];
            flaschenBild.src = typeToImage[msg.type] || "";

            //antworten holen

            loadResponses(msg.idFlaschen);

          });

          if (hoursAgo <= 24) {
            document.getElementById("row3").appendChild(img);
          } else if (hoursAgo <= 48) {
            document.getElementById("row2").appendChild(img);
          } else if (hoursAgo <= 72) {
            document.getElementById("row1").appendChild(img);
          }
          
        });
      } else {
        messagesDiv.textContent = "Fehler beim Laden der Nachrichten.";
      }
    })
    .catch(() => {
      messagesDiv.textContent = "Fehler beim Laden der Nachrichten.";
    });

    
}

function loadResponses(idFlaschen) {
            const respBox = document.getElementById("respBox");
            const respAbs = document.getElementById("respAbs");
            respBox.innerHTML = ""; // vorherige Antworten löschen

              fetch("http://localhost:3000/api/responses")
                .then(res => res.json())
                .then(data => {
                  if (data.success) {
                    const responses = data.messages.filter(resp => resp.idParent == idFlaschen);

                    if (responses.length === 0) {
                      respBox.textContent = "Noch keine Antworten.";
                      return;
                    }

                    responses.forEach(resp => {
                      const respEl = document.createElement("div");
                      respEl.className = "response";
                      //respAbs.textContent = resp.timeResp;
                      respEl.textContent = resp.msgResp;
                      
                      respBox.appendChild(respEl);

                      const spacer = document.createElement("div");
                      spacer.style.height = "10px"; // oder "1em", je nach Wunsch
                      respBox.appendChild(spacer);
                      
                    });
                  } else {
                    respBox.textContent = "fehler.";
                  }
                })
 //               .catch(() => {
 //                 respBox.textContent = "Fehler beim Laden der Antworten.";
 //               });
            }

//NEUE NACHRICHT FENSER


openNeu.addEventListener("click", () => {
  neueNachricht.style.display = "flex";
});

// farbe nach auswahl anpassen

const colorRadios = document.querySelectorAll('input[name="color"]');
const typeRadios = document.querySelectorAll('input[name="type"]');
const msgInput = document.getElementById('msgInput');
const neueNachrichtFenster = document.getElementById("neueNachricht-modal-content");
const flaschePreview = document.getElementById("flaschePreview");

colorRadios.forEach(radio => {
  radio.addEventListener('change', () => {
    switch (radio.value) {
      case 'cl0': // Weiss
        neueNachrichtFenster.style.backgroundColor = 'rgb(255,255,255,0.5)';
        neueNachrichtFenster.style.color = 'rgb(0,0,0)';
        break;
      case 'cl1': // Schwarz
        neueNachrichtFenster.style.backgroundColor = 'rgb(40,40,40,0.5)';
        neueNachrichtFenster.style.color = 'rgb(255,255,255)';
        break;
      case 'cl2': // Rot
        neueNachrichtFenster.style.backgroundColor = 'rgb(220,50,50,0.5)';
        neueNachrichtFenster.style.color = 'rgb(255,255,255)';
        break;
      case 'cl3': // Blau
        neueNachrichtFenster.style.backgroundColor = 'rgb(55,179,220,0.5)';
        neueNachrichtFenster.style.color = 'rgb(0,0,0)';
        break;
      case 'cl4': // Grün
        neueNachrichtFenster.style.backgroundColor = 'rgb(56,220,89,0.5)';
        neueNachrichtFenster.style.color = 'rgb(0,0,0)';
        break;
      case 'cl5': // Lila
        neueNachrichtFenster.style.backgroundColor = 'rgb(212,55,220,0.5)';
        neueNachrichtFenster.style.color = 'rgb(255,255,255)';
        break;
      case 'cl6': // Gelb
        neueNachrichtFenster.style.backgroundColor = 'rgb(210,178,50,0.5)';
        neueNachrichtFenster.style.color = 'rgb(0,0,0)';
        break;
    }
  });
});

typeRadios.forEach(radio => {
  radio.addEventListener('change', () => {
    switch (radio.value) {
      case 'fl1':
        flaschePreview.src="http://localhost:3000/flaschen/anim/1.gif"
        break;
      case 'fl2':
        flaschePreview.src="http://localhost:3000/flaschen/anim/2.gif"
        break;
      case 'fl3':
        flaschePreview.src="http://localhost:3000/flaschen/anim/3.gif"
        break;
      case 'fl4':
        flaschePreview.src="http://localhost:3000/flaschen/anim/4.gif"
        break;
      case 'fl5':
        flaschePreview.src="http://localhost:3000/flaschen/anim/5.gif"
        break;
      case 'fl6':
        flaschePreview.src="http://localhost:3000/flaschen/anim/6.gif"
        break;
    }
  });
});



/*
    // Modal schließen
    closeModalBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });
*/
    // Modal auch schließen, wenn man außerhalb klickt


    loadMessages();
    setInterval(loadMessages, 5000);



// horizontales scrollen übersetzen

const rows = document.querySelectorAll('.message-row1, .message-row2, .message-row3');

rows.forEach(row => {
  row.addEventListener('wheel', function (e) {
    // Standardverhalten (vertikales Scrollen) verhindern
    e.preventDefault();

    // Horizontal scrollen (z. B. nach rechts bei Scroll runter)
    row.scrollLeft += e.deltaY;
  }, { passive: false });
});





//nachricht senden

    sendBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      const msg = msgInput.value.trim();
      //const type = typeInput.value.trim();
      const type = document.querySelector('input[name="type"]:checked')?.value || "";
      //const color = colorInput.value.trim();
      const color = document.querySelector('input[name="color"]:checked')?.value || "";

      if (!name || !msg) {
        alert("Bitte Name und Nachricht eingeben.");
        return;
      }

      fetch("http://localhost:3000/api/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, msg, type, color }),
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            msgInput.value = "";
            loadMessages();
            neueNachricht.style.display = "none";
          } else {
            alert("Fehler beim Senden der Nachricht.");
          }
        })
        .catch(() => {
          alert("Fehler beim Senden der Nachricht.");
        });
    });

// antwort senden

    respBtn.addEventListener("click", () => {

      const idParent = modalID.textContent.trim();
      const msgResp = respInput.value.trim();
      

      if (!msgResp) {
        alert("Bitte Nachricht eingeben.");
        return;
      }

      fetch("http://localhost:3000/api/responses", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ idParent, msgResp }),
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            respInput.value = "";
            loadMessages();
            loadResponses(idParent);
            respInput.style.height = "auto";
            
          } else {
            alert("Fehler im else beim Senden der Antwort.");
          }
        })
        .catch(() => {
          alert("Fehler im catch beim Senden der Antwort.");
        });
        
    });


    




    //ARCHIV ÖFFNEN
    function loadArchive() {

        const archivDiv = document.getElementById("archiv");
        const archivOpen = document.getElementById("archivOpen");

        const typeToImage = {
          fl1: "http://localhost:3000/flaschen/anim/1.gif",
          fl2: "http://localhost:3000/flaschen/anim/2.gif",
          fl3: "http://localhost:3000/flaschen/anim/3.gif",
          fl4: "http://localhost:3000/flaschen/anim/4.gif",
          fl5: "http://localhost:3000/flaschen/anim/5.gif",
          fl6: "http://localhost:3000/flaschen/anim/6.gif",
        };

        const msgCol = {
          cl0: "rgb(255,255,255,0.5)",
          cl1: "rgb(40,40,40,0.5)",       // schwarz
          cl2: "rgb(220,50,50,0.5)",      // rot
          cl3: "rgb(55,180,220,0.5)",     // blau
          cl4: "rgb(56,220,90,0.5)",      // grün
          cl5: "rgb(212,55,220,0.5)",     // lila
          cl6: "rgb(220,180,50,0.5)",     // gelb
        };

        const txtCol = {
          cl0: "rgb(0,0,0)",
          cl1: "rgb(255,255,255)",    // schwarz
          cl2: "rgb(255,255,255)",    // rot
          cl3: "rgb(0,0,0)",          // blau
          cl4: "rgb(0,0,0)",          // grün
          cl5: "rgb(255,255,255)",    // lila
          cl6: "rgb(0,0,0)",          // gelb
        };

  archivOpen.addEventListener("click", () => {

const archivModal = document.getElementById("archivModal");
const archivGrid = document.getElementById("archivGrid");
const closeArchiv = document.getElementById("closeArchiv");

// ÖFFNEN

  archivGrid.innerHTML = ""; // leeren

fetch("http://localhost:3000/api/messages")
  .then(res => res.json())
  .then(data => {
    if (data.success && data.messages.length > 0) {
      // Sortieren: Neueste zuerst
      data.messages.sort((a, b) => new Date(b.time) - new Date(a.time));

      data.messages.forEach(msg => {
        const card = document.createElement("div");
        card.className = "archivCard";
        card.style.backgroundColor = msgCol[msg.color];
        card.style.color = txtCol[msg.color];

        const imgArch = document.createElement("img");
        imgArch.src = typeToImage[msg.type];

        const title = document.createElement("p");

        //zeitformat konvertieren
        const formattedTime = new Date(msg.time).toLocaleString("de-DE", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        });

        title.innerHTML = `von <b>${msg.name}</b> am <b>${formattedTime}</b>`;

        const content = document.createElement("p");
        content.textContent = msg.msg;

        const flasche = document.createElement("small");
        flasche.classList.add("id-label");
        flasche.innerHTML = `<br><br>Flaschenpost-ID: ${msg.idFlaschen}`;
        

        const AntwortenA = document.createElement("div");
        AntwortenA.innerHTML = "<b>Antworten:</b>";
        
        card.appendChild(imgArch);
        card.appendChild(title);
        card.appendChild(content);
        card.appendChild(AntwortenA);


        const respBoxArch = document.createElement("small");
        respBoxArch.className = "responses-container-archive";
        card.appendChild(respBoxArch);

        card.appendChild(flasche);

//antworten im archiv

        fetch("http://localhost:3000/api/responses")
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              const responses = data.messages.filter(resp => resp.idParent == msg.idFlaschen);

              if (responses.length === 0) {
                respBoxArch.textContent = "keine Antworten :(";
                return;
              }

              responses.forEach(resp => {
                const respEl = document.createElement("p");
                respEl.className = "response";
                respEl.textContent = resp.msgResp;
                respBoxArch.appendChild(respEl);

                //const spacer = document.createElement("br");
                //respBoxArch.appendChild(spacer);
        });
            } else {
              respBox.textContent = "fehler.";
            }
          })
            
//ende


        archivGrid.appendChild(card);
      });
    } else {
      archivGrid.innerHTML = "Keine Nachrichten im Archiv.";
    }

    archivModal.style.display = "flex";
  })


    .catch(() => {
      archivGrid.innerHTML = "Fehler beim Laden des Archivs.";
      archivModal.style.display = "flex";
    });

      });

    }
  
loadArchive();

//himmel updaten

 function updateGradient() {
      const now = new Date();
const hour = now.getHours();

let topColor, middleColor, bottomColor;

if (hour < 6) {
  // Nacht
  topColor = '#060C29';
  middleColor = '#3C3356';
  bottomColor = '#3C3356';

} else if (hour < 8) {
  // Morgen
  topColor = '#385CFF';
  middleColor = '#FF723A';
  bottomColor = '#FF723A';

} else if (hour < 20) {
  // Mittag
  topColor = '#38ACFF';
  middleColor = '#C1F4FF';
  bottomColor = '#C1F4FF';

} else if (hour < 22) {
  // Abend
  topColor = '#385CFF';
  middleColor = '#FF723A';
  bottomColor = '#FF723A';
  
} else {
  // Nacht
  topColor = '#060C29';
  middleColor = '#3C3356';
  bottomColor = '#3C3356';
}

document.body.style.background = `
  linear-gradient(to bottom,
    ${topColor} 0%,
    ${middleColor} 50%,
    ${bottomColor} 100%)
`;
    }

    // Aktualisiere den Farbverlauf jede Minute
    updateGradient();
    setInterval(updateGradient, 60000);




</script>

<style>

  body {
  margin: 0;
  padding: 0;
  /*background: linear-gradient(to bottom, #38ACFF, #C1F4FF, #ffffff);*/
  height: 100vh;
  overflow: hidden;
  font-family: "pixel";

  
}


@font-face {
  font-family: "pixel";
  src: url('http://localhost:3000/pokemon-bw.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}

html {
  font-size: 30px; /* Standard sind 16px → also 12.5% größer */
}

#himmel {
  height: 100%;
  width: 100%;
  z-index: -300;
  position: absolute;
  pointer-events: none;
  overflow: hidden;
}

#respBox {
  max-width: 45vw; /* oder z.B. 80% */
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
}

#flaschenContainer {
  position: fixed;
  bottom: 0;
  width: 100vw;
  height: 50vh;
  pointer-events: auto;
  

}

#hintergrund {
  pointer-events: auto;
}

#bg {
  position: fixed;
  justify-self: top;
  top: 50vh;
  object-position: top;
  left: 0;
  width: 100vw;
  height: 100%; /* z.B. halbe Höhe */
  object-fit: cover; /* Zuschneiden, damit es die Fläche gut ausfüllt */
  z-index: -100; /* Hinter dem Content */
  pointer-events: none; /* Klicks gehen durch das Video durch */
  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
}

#bg video {
  pointer-events: none;
  
}

#land img {
  position: fixed;
  bottom: 41vh;
  right: 0;
  width: 580px;
  height: 300px; /* z.B. halbe Höhe */
  /*object-fit: fill; /* Zuschneiden, damit es die Fläche gut ausfüllt */
  z-index: -50; /* Hinter dem Content */
  pointer-events: none;
  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
  
}

#schiff img {
  position: fixed;
  bottom: 44vh;
  left: 1vw;
  width: 500px;
  height: 250px;
  z-index: -150;
  cursor: pointer;
  pointer-events: auto;
  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
  transition: transform 0.1s;
  transform-origin: 50% 80%;
}


.archivOpen {
  background: rgb(0, 0, 0);      /* Kein Hintergrund */
  border: none;          /* Keine Umrandung */
  padding: 0;            /* Kein Innenabstand */
  margin: 0;             /* Kein Außenabstand */
  cursor: pointer;       /* Mauszeiger zeigt Klick an */
  width: 300px;          /* Breite des Buttons */
  height: 100px;          /* Höhe des Buttons */
  opacity: 0%;            /* komplett unsichtbar */
  bottom: 52vh;
  position: fixed;    /* falls nötig */
}

.archivOpen:hover + #schiff img {
  transform: scale(1.2);
}

.msg-button {
padding: 10px 15px;
font-weight: bold;
cursor: pointer;
border: 1px solid #000000;
background-color: #f0f0f0;
border-radius: 4px;
flex: 1 0 150px; /* Mindestens 150px breit, flexibel */
text-align: center;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

/* Modal-Hintergrund */
.modal {
display: none; /* versteckt */
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100vw;
height: 100vh;
background-color: rgba(255, 255, 255, 0);
justify-content: center;
align-items: center;

}

/* Modal-Inhalt */
.modal-content {
padding: 10px;
width: 60vw;
height: 70vh;
overflow-y: auto;
box-shadow: 0 2px 10px rgba(0,0,0,0.3);
background-color: rgba(255, 255, 255, 0);
position: relative;
color: rgb(0, 0, 0);
display: flex;
word-wrap: break-word;
border-radius: 0px;
border: 10px solid black;
flex-direction: row;
backdrop-filter: blur(30px);
-webkit-backdrop-filter: blur(30px); /* Für Safari */
}

#links {
  flex: 1;                 /* 1 Anteil → schmaler */
  padding: 10px;
  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
  
}

#rechts {
  flex: 2;                 /* 2 Anteile → breiter */
  padding: 10px;
  max-width: 40vw;
  overflow-y: auto;
  
}

.modal-content::-webkit-scrollbar {
  height: 0px;
  width: 0px;
}
.modal-content::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 0px;
}

#antwortenScroll {
  max-height: 300px; /* oder was du brauchst */
  overflow-y: auto;
  padding-right: 5px; /* optional, Platz für Scrollbar */
  margin-top: 10px;
  scroll-behavior: smooth;
  
}

#antwortenScroll::-webkit-scrollbar {
  width: 6px;
}

#antwortenScroll::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.3);
  border-radius: 3px;
}

#msgBox {
  display: block;         /* Standard-Block-Layout */
  
  padding: 0px;
  margin-top: 40px;
  
  overflow: visible;      /* Falls Inhalte größer sind */
  height: auto;           /* Wichtig: automatische Höhe */
  border-radius: 30px;
  font-size: 16pt;
}

.resp-Wrapper {
  display: flex;
  align-items: stretch;
  gap: 10px;
  margin-top: 30px;
  margin-bottom: 30px;
}

#respInput {
  flex: 1;
  width: 30vw;
  resize: none;
  border: 5px solid black;
  font-family: pixel;
  font-size: 24pt;
  background-color: #ffffff;
  padding-left: 10px;
}

#respBtn {
  flex-shrink: 0;
  height: 100%;
  width: 50px;
  border: 5px solid black;

  align-items: center;
  justify-content: center;
  display: flex;

  font-family: pixel;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  cursor: pointer;
  background-color: #ffffff;
}

#respBtn img {
  object-fit: contain;
  width: 120%;
  height: 120%;
}


#flaschenBild {
height: 100%;
width: auto;
object-fit: contain;
border-radius: 20px;
margin-left: 2vw;
}


#msgGloss {
  display: flex;
  height: auto;
  width: auto;
  background-color: #ffffff;
}

#nameInput {
  width: 100%;
  font-size: 30pt;
  font-family: "pixel";
  padding: 8px;
  border: 3px solid black;
  background-color: white;
}

#msgInput {
  width: 100%;
  font-size: 30pt;
  font-family: "pixel";
  padding: 8px;
  border: 3px solid black;
  background-color: white;
}



#neueNachricht {
  display: none; /* versteckt */
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0);
  justify-content: center;
  align-items: center;
}

/* Modal-Inhalt NEUE NACHRICHT */
#neueNachricht-modal-content {
  padding: 20px;
  border-radius: 0px;
  border: 10px solid black;
  width: 60vw;
  height: 70vh;
  overflow-y: auto;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  position: relative;
  color: rgb(255,255,255);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px); /* Für Safari */

  color: rgb(0, 0, 0);
  display: flex;
  flex-direction: row;

}



#neuLinks {
  flex: 1;                 /* 1 Anteil → schmaler */
  
  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
  
}

#neuRechts {
  flex: 2;                 /* 2 Anteile → breiter */
  padding-right: 10px;
  max-width: 40vw;
  flex-direction: column;
}

#flaschePreview {
  height: 100%;
  margin-left: 2vw;
}

#sendBtn {
  width: 100%;
  height: 70px;
  position: relative;
  color: black;
  background-color: #52a6f4;
  border: 3px solid black;
  font-family: "pixel";
  font-size: 30pt;
  cursor: pointer;
}

/* Schließen-Button */
/*    .close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  border: none;
  background: none;
} */


.message {
  border-bottom: 0px solid #eee;
  padding: 0px 0;
}
.name {
  font-weight: bold;
}
.time {
  font-size: 0.8em;
  color: #999;
  margin-left: 0;
}


/*FLASCHEN STYLE*/

.msg-image {
  flex: 0 0 auto;
  height: 100%;            /* Neu: volle Höhe des Containers */
  width: auto;             /* Automatische Breite für Seitenverhältnis */
  object-fit: contain;     /* Bild vollständig sichtbar halten */
  border-radius: 6px;
  cursor: pointer;
  transition: transform 0.1s;
  transform-origin: 50% 100%;
}

.msg-image:hover {
  transform: scale(1.2);
}

/* NACHRICHTEN ZEILEN */

/*1*/

.message-row1 {
  display: flex;
  flex-wrap: nowrap;
  gap: 8px;
  padding: 0px;
  border: 0px solid #000000;
  margin-bottom: 10px;
  scrollbar-width: thin;
  height: 5vh;
  justify-content: space-evenly;
  transform: translateY(2vh);
  z-index: 50;
  scroll-behavior: smooth;
  position: relative;

  overflow-x: scroll;   /* immer Scrollbar reservieren! */
  overflow-y: hidden;

  /* Firefox: unsichtbare Scrollbar (aber Platz reserviert) */
  scrollbar-width: thin;
  scrollbar-color: transparent transparent;

  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
}

/* Firefox: bei Hover sichtbar */
.message-row1:hover {
  scrollbar-color: rgba(0, 0, 0, 0.4) transparent;
}

/* Chrome, Safari, Edge (WebKit) */
.message-row1::-webkit-scrollbar {
  height: 6px;
  background: transparent; /* track */
}

.message-row1::-webkit-scrollbar-thumb {
  background-color: transparent; /* unsichtbar, aber Platz bleibt */
  transition: background-color 0.3s ease;
}

.message-row1:hover::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.4); /* sichtbar bei Hover */
}

/*2*/

.message-row2 {
  display: flex;
  flex-wrap: nowrap;
  gap: 8px;
  padding: 0px;
  border: 0px solid #000000;
  margin-bottom: 10px;
  scrollbar-width: thin;
  height: 10vh;
  justify-content: space-evenly;
  z-index: 40;
  scroll-behavior: smooth;
  position: relative;

  overflow-x: scroll;   /* immer Scrollbar reservieren! */
  overflow-y: hidden;

  /* Firefox: unsichtbare Scrollbar (aber Platz reserviert) */
  scrollbar-width: thin;
  scrollbar-color: transparent transparent;

  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
}

/* Firefox: bei Hover sichtbar */
.message-row2:hover {
  scrollbar-color: rgba(0, 0, 0, 0.4) transparent;
}

/* Chrome, Safari, Edge (WebKit) */
.message-row2::-webkit-scrollbar {
  height: 6px;
  background: transparent; /* track */
}

.message-row2::-webkit-scrollbar-thumb {
  background-color: transparent; /* unsichtbar, aber Platz bleibt */
  transition: background-color 0.3s ease;
}

.message-row2:hover::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.4); /* sichtbar bei Hover */
}



/*3*/

.message-row3 {
  display: flex;
  flex-wrap: nowrap;
  gap: 8px;
  padding: 10px;
  margin-bottom: 10px;
  height: 25vh;
  justify-content: space-evenly;
  z-index: 30;
  transform: translateY(-50px);
  scroll-behavior: smooth;
  position: relative;

  overflow-x: scroll;   /* immer Scrollbar reservieren! */
  overflow-y: hidden;

  /* Firefox: unsichtbare Scrollbar (aber Platz reserviert) */
  scrollbar-width: thin;
  scrollbar-color: transparent transparent;

  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
}

/* Firefox: bei Hover sichtbar */
.message-row3:hover {
  scrollbar-color: rgba(0, 0, 0, 0.4) transparent;
}

/* Chrome, Safari, Edge (WebKit) */
.message-row3::-webkit-scrollbar {
  height: 6px;
  background: transparent; /* track */
}

.message-row3::-webkit-scrollbar-thumb {
  background-color: transparent; /* unsichtbar, aber Platz bleibt */
  transition: background-color 0.3s ease;
}

.message-row3:hover::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.4); /* sichtbar bei Hover */
}



.message-row1:has(.msg-image:nth-child(n + 50)),
.message-row2:has(.msg-image:nth-child(n + 30)),
.message-row3:has(.msg-image:nth-child(n + 9)) {
  justify-content: flex-start;
}


.archivModal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255, 255, 255, 0.0);
  justify-content: center;
  align-items: center;
  pointer-events: auto; /* ← HIER */
  word-wrap: break-word;
}



/* MODAL ARCHIV */
.modal-content-archiv {
  padding: 20px;
  width: 80vw;
  height: 80vh;
  overflow-y: auto;
  background-color: rgba(255, 255, 255, 0.5);
  border-radius: 0px;
  border: 10px solid black;
  position: relative;
  display: flex;
  flex-direction: column;
  scroll-behavior: smooth;
  scrollbar-width: 0px;
  word-wrap: break-word;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px); /* Für Safari */
}

.modal-content-archiv::-webkit-scrollbar {
  height: 0px;
  width: 0px;
}
.modal-content-archiv::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 0px;
}



#archivGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* responsive */
  gap: 20px;
  margin-top: 20px;
}


/* Einzelne Nachricht */
.archivCard {
  border: 0px solid #ffffff;
  border-radius: 0px;
  border: 5px solid black;
  background-color: #ffffff;
  padding: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  word-wrap: break-word;
  max-width: 400px;       /* ← Hier */
  width: 100%;            /* ← Nimmt volle Breite der Grid-Spalte */
  box-sizing: border-box; /* ← Verhindert Überschreiten durch Padding */
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px); /* Für Safari */
  image-rendering: pixelated;
  image-rendering: crisp-edges; /* für zusätzliche Kompatibilität */
  padding-bottom: 50px;
}


.close-btn {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 28px;
  font-weight: bold;
  border: none;
  background: none;
  cursor: pointer;
}

.id-label {
  position: absolute;
  bottom: 8px;
  left: 0.8vw;
  font-size: 0.7em;
}




</style>
</body>
</html>
